<div class="container" style="padding-top: 50px;">

	<div class="row">
		<div class="col-md-12">
			<h1 style="margin-bottom: 20px;">
				<span class="glyphicon glyphicon-check"></span> POPå¾½ç« ç­¾åˆ°è®°å½•
				<small>æŒ‰æœˆæŸ¥çœ‹Core IDç­¾åˆ°ç»Ÿè®¡</small>
			</h1>
		</div>
	</div>

	<!-- æ§åˆ¶é¢æ¿ -->
	<div class="row">
		<div class="col-md-12">
			<div class="card table-card">
				<div class="card-header">
					<h5 style="margin: 0;">
						<span class="glyphicon glyphicon-calendar"></span> æœˆä»½æ§åˆ¶
					</h5>
				</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-4">
							<div class="form-group">
								<label>å½“å‰æ˜¾ç¤ºæœˆä»½</label>
								<div>
									<h4 style="margin: 0;">
										<span class="glyphicon glyphicon-calendar"></span> 
										{{currentMonth || 'æ­£åœ¨åŠ è½½...'}}
									</h4>
								</div>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label>æœˆä»½å¯¼èˆª</label>
								<div>
									<div class="btn-group" role="group" style="margin-bottom: 5px;">
										<button class="btn btn-outline-primary" ng-click="goPreviousMonth()" ng-disabled="!canGoPreviousMonth">
											<span class="glyphicon glyphicon-chevron-left"></span> ä¸Šä¸€æœˆ
										</button>
										<button class="btn btn-primary" ng-click="loadMore()" 
																		ng-disabled="isLoading || !hasMoreData">
											<span ng-if="!isLoading" class="glyphicon glyphicon-download"></span>
											<span ng-if="isLoading" class="glyphicon glyphicon-refresh glyphicon-spin"></span>
											{{isLoading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}
										</button>
										<button class="btn btn-outline-primary" ng-click="goNextMonth()" ng-disabled="!canGoNextMonth">
											ä¸‹ä¸€æœˆ <span class="glyphicon glyphicon-chevron-right"></span>
										</button>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label>ç»Ÿè®¡ä¿¡æ¯</label>
								<div class="loading-status">
									<span ng-if="loadedCount > 0">
										å·²åŠ è½½ {{loadedCount}} æ¡è®°å½• / å…± {{totalRecords}} æ¡è®°å½•
									</span>
									<span ng-if="!hasMoreData && loadedCount > 0" class="text-success">
										<span class="glyphicon glyphicon-ok"></span> å·²åŠ è½½æ‰€æœ‰æ•°æ®
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- å®Œæ•´æ€§æ£€æŸ¥çŠ¶æ€ -->
	<div class="row" ng-if="currentMonthIntegrity">
		<div class="col-md-12">
			<div class="alert" 
				 ng-class="{
						   'alert-success': currentMonthIntegrity.status === 'valid',
						   'alert-warning': currentMonthIntegrity.status === 'warning',
						   'alert-danger': currentMonthIntegrity.status === 'error',
						   'alert-info': currentMonthIntegrity.status === 'checking' || currentMonthIntegrity.status === 'loading'
						   }">
				<span ng-if="currentMonthIntegrity.status === 'checking' || currentMonthIntegrity.status === 'loading'">
					<span class="glyphicon glyphicon-refresh glyphicon-spin"></span>
				</span>
				<span ng-if="currentMonthIntegrity.status === 'valid'">
					<span class="glyphicon glyphicon-ok"></span>
				</span>
				<span ng-if="currentMonthIntegrity.status === 'warning'">
					<span class="glyphicon glyphicon-warning-sign"></span>
				</span>
				{{currentMonthIntegrity.message}}

				<button ng-if="currentMonthIntegrity.status === 'warning'" 
						class="btn btn-sm btn-primary pull-right" 
						ng-click="reloadCurrentMonth()">
					<span class="glyphicon glyphicon-refresh"></span> é‡æ–°æ£€æŸ¥
				</button>
			</div>
		</div>
	</div>

	<!-- å½“å‰æœˆä»½æ•°æ®è¡¨æ ¼ -->
	<div class="row" ng-if="currentMonthStats">
		<div class="col-md-12">
			<div class="card table-card">
				<div class="card-header">
					<h4 style="margin: 0;">
						<span class="glyphicon glyphicon-list"></span> {{currentMonthStats.monthYear}} ç­¾åˆ°ç»Ÿè®¡
						<span class="badge" style="background-color: #007bff; margin-left: 10px;">
							{{currentMonthStats.totalCheckIns}} æ¬¡ç­¾åˆ°
						</span>
						<span class="badge" style="background-color: #6c757d;">
							{{currentMonthStats.uniqueCores}} ä¸ªCore ID
						</span>
					</h4>
				</div>
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-striped table-hover">
							<thead>
								<tr>
									<th>Core ID</th>
									<th>ç­¾åˆ°æ¬¡æ•°</th>
									<th>é¦–æ¬¡ç­¾åˆ°æ—¶é—´ (UTC+8)</th>
									<th>é¦–æ¬¡ç­¾åˆ°åŒºå—é«˜åº¦</th>
									<th>æœ€åç­¾åˆ°æ—¶é—´ (UTC+8)</th>
									<th>æœ€åç­¾åˆ°åŒºå—é«˜åº¦</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="coreStat in currentMonthStats.coreStats">
									<td>
										<strong>ğŸ†”J{{coreStat.coreId}}</strong>
									</td>
									<td>
										<span class="badge" style="background-color: #28a745;">{{coreStat.count}} æ¬¡</span>
									</td>
									<td>
										{{coreStat.firstCheckInTime}}
									</td>
									<td>
										<a href="./#/block/{{coreStat.firstBlockNumber}}" 
										   ng-if="coreStat.firstBlockNumber !== '-'">
											{{coreStat.firstBlockNumber}}
										</a>
										<span ng-if="coreStat.firstBlockNumber === '-'">-</span>
									</td>
									<td>
										{{coreStat.lastCheckInTime}}
									</td>
									<td>
										<a href="./#/block/{{coreStat.lastBlockNumber}}" 
										   ng-if="coreStat.lastBlockNumber !== '-'">
											{{coreStat.lastBlockNumber}}
										</a>
										<span ng-if="coreStat.lastBlockNumber === '-'">-</span>
									</td>
								</tr>
							</tbody>
						</table>
					</div>

					<!-- æ— æ•°æ®æç¤º -->
					<div ng-if="currentMonthStats.coreStats.length === 0" class="alert alert-info">
						<span class="glyphicon glyphicon-info-sign"></span>
						å½“å‰æœˆä»½æ²¡æœ‰ç­¾åˆ°è®°å½•ã€‚
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- åŠ è½½çŠ¶æ€æç¤º -->
	<div class="row" ng-if="isLoading">
		<div class="col-md-12">
			<div class="alert alert-info text-center">
				<span class="glyphicon glyphicon-refresh glyphicon-spin"></span>
				æ­£åœ¨åŠ è½½æ•°æ®ï¼Œè¯·ç¨å€™...
			</div>
		</div>
	</div>

	<!-- æ— æ•°æ®æç¤º -->
	<div class="row" ng-if="!isLoading && !currentMonthStats">
		<div class="col-md-12">
			<div class="alert alert-info">
				<span class="glyphicon glyphicon-info-sign"></span>
				æš‚æ— ç­¾åˆ°è®°å½•ã€‚
			</div>
		</div>
	</div>

</div>

<style>
.table-card {
	margin-bottom: 20px;
}
	.badge {
		margin-left: 5px;
	}
	.loading-status {
		padding: 8px;
		background-color: #f8f9fa;
		border-radius: 4px;
		text-align: center;
	}
	.glyphicon-spin {
		-webkit-animation: spin 1s infinite linear;
		animation: spin 1s infinite linear;
	}
	@-webkit-keyframes spin {
		0% { -webkit-transform: rotate(0deg); }
		100% { -webkit-transform: rotate(360deg); }
	}
	@keyframes spin {
		0% { transform: rotate(0deg); }
		100% { transform: rotate(360deg); }
	}
</style>

<div class="container" style="padding-top: 50px;">

	<div class="row">
		<div class="col-md-12">
			<h1 style="margin-bottom: 20px;">
				<span class="glyphicon glyphicon-check"></span> POPå¾½ç« ç­¾åˆ°è®°å½•
				<small>æŒ‰æœˆæŸ¥çœ‹Core IDé“¾ä¸Šç­¾åˆ°ç»Ÿè®¡</small>
			</h1>
		</div>
	</div>

	<!-- æ§åˆ¶é¢æ¿ -->
	<div class="row">
		<div class="col-md-12">
			<div class="card table-card">
				<div class="card-header">
					<h5 style="margin: 0;">
						<span class="glyphicon glyphicon-calendar"></span> æœˆä»½æ§åˆ¶
					</h5>
				</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-4">
							<div class="form-group">
								<label>å½“å‰æ˜¾ç¤ºæœˆä»½</label>
								<div>
									<h4 style="margin: 0;">
										<span class="glyphicon glyphicon-calendar"></span> 
										{{currentMonth || 'æ­£åœ¨åŠ è½½...'}}
									</h4>
								</div>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label>æœˆä»½å¯¼èˆª</label>
								<div>
									<div class="btn-group" role="group" style="margin-bottom: 5px;">
										<button class="btn btn-outline-primary" ng-click="goBack()" ng-disabled="!canGoBack">
											<span class="glyphicon glyphicon-chevron-left"></span> ä¸Šä¸€æœˆ
										</button>
										<button class="btn btn-primary" ng-click="loadNextMonth()" 
																		ng-disabled="isLoading || !hasMoreData">
											<span ng-if="!isLoading" class="glyphicon glyphicon-arrow-down"></span>
											<span ng-if="isLoading" class="glyphicon glyphicon-refresh glyphicon-spin"></span>
											{{isLoading ? 'åŠ è½½ä¸­...' : 'åŠ è½½ä¸Šä¸€ä¸ªæœˆ'}}
										</button>
										<button class="btn btn-outline-primary" ng-click="goForward()" ng-disabled="!canGoForward">
											ä¸‹ä¸€æœˆ <span class="glyphicon glyphicon-chevron-right"></span>
										</button>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label>ç»Ÿè®¡ä¿¡æ¯</label>
								<div class="loading-status">
									<span ng-if="loadedCount > 0">
										å·²åŠ è½½ {{loadedCount}} æ¡è®°å½• / å…± {{totalRecords}} æ¡è®°å½•
									</span>
									<span ng-if="!hasMoreData && loadedCount > 0" class="text-success">
										<span class="glyphicon glyphicon-ok"></span> å·²åŠ è½½æ‰€æœ‰æœˆä»½
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- å†å²æœˆä»½å¿«é€Ÿå¯¼èˆª -->
	<div class="row" ng-if="monthHistory && monthHistory.length > 1">
		<div class="col-md-12">
			<div class="card table-card">
				<div class="card-header">
					<h5 style="margin: 0;">
						<span class="glyphicon glyphicon-time"></span> å†å²æœˆä»½å¿«é€Ÿå¯¼èˆª
					</h5>
				</div>
				<div class="card-body">
					<div class="btn-group" role="group">
						<button type="button" class="btn btn-outline-secondary" 
											  ng-repeat="month in monthHistory track by $index"
											  ng-class="{'btn-primary': $index === historyPosition}"
											  ng-click="goToHistoryMonth(month.monthKey)">
							{{month.monthYear}}
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- ç­›é€‰æ§åˆ¶é¢æ¿ -->
	<div class="row" ng-if="currentMonthStats">
		<div class="col-md-12">
			<div class="card table-card">
				<div class="card-header">
					<h5 style="margin: 0;"><span class="glyphicon glyphicon-filter"></span> ç­›é€‰é€‰é¡¹</h5>
				</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-6">
							<div class="form-group">
								<label for="coreFilter">ç­›é€‰Core ID</label>
								<select class="form-control" id="coreFilter" ng-model="selectedCoreId" 
																			 ng-change="filterByCore()">
									<option value="">å…¨éƒ¨Core ID</option>
									<option ng-repeat="coreId in availableCoreIds" value="{{coreId}}">ğŸ†”J{{coreId}}</option>
								</select>
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group">
								<label>æœˆä»½ç»Ÿè®¡</label>
								<div>
									<span class="badge" style="background-color: #007bff; margin-right: 5px;">
										{{currentMonthStats.totalCheckIns}} æ¬¡ç­¾åˆ°
									</span>
									<span class="badge" style="background-color: #6c757d;">
										{{currentMonthStats.uniqueCores}} ä¸ªCore ID
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- å½“å‰æœˆä»½æ•°æ®è¡¨æ ¼ -->
	<div class="row" ng-if="currentMonthStats">
		<div class="col-md-12">
			<div class="card table-card">
				<div class="card-header">
					<h4 style="margin: 0;">
						<span class="glyphicon glyphicon-list"></span> {{currentMonthStats.monthYear}} é“¾ä¸Šç­¾åˆ°ç»Ÿè®¡
					</h4>
				</div>
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-striped table-hover">
							<thead>
								<tr>
									<th>Core ID</th>
									<th>ç­¾åˆ°æ¬¡æ•°</th>
									<th>é¦–æ¬¡ç­¾åˆ°æ—¶é—´ (UTC+8)</th>
									<th>é¦–æ¬¡ç­¾åˆ°åŒºå—é«˜åº¦</th>
									<th>æœ€åç­¾åˆ°æ—¶é—´ (UTC+8)</th>
									<th>æœ€åç­¾åˆ°åŒºå—é«˜åº¦</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="coreStat in currentMonthStats.coreStats">
									<td>
										<strong>ğŸ†”J{{coreStat.coreId}}</strong>
									</td>
									<td>
										<span class="badge" style="background-color: #28a745;">{{coreStat.count}} æ¬¡</span>
									</td>
									<td>
										{{coreStat.firstCheckInTime}}
									</td>
									<td>
										<a href="./#/block/{{coreStat.firstBlockNumber}}" 
										   ng-if="coreStat.firstBlockNumber !== '-'">
											{{coreStat.firstBlockNumber}}
										</a>
										<span ng-if="coreStat.firstBlockNumber === '-'">-</span>
									</td>
									<td>
										{{coreStat.lastCheckInTime}}
									</td>
									<td>
										<a href="./#/block/{{coreStat.lastBlockNumber}}" 
										   ng-if="coreStat.lastBlockNumber !== '-'">
											{{coreStat.lastBlockNumber}}
										</a>
										<span ng-if="coreStat.lastBlockNumber === '-'">-</span>
									</td>
								</tr>
							</tbody>
						</table>
					</div>

					<!-- æ— æ•°æ®æç¤º -->
					<div ng-if="currentMonthStats.coreStats.length === 0" class="alert alert-info">
						<span class="glyphicon glyphicon-info-sign"></span>
						å½“å‰æœˆä»½æ²¡æœ‰åŒ¹é…çš„ç­¾åˆ°è®°å½•ã€‚
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- åŠ è½½çŠ¶æ€æç¤º -->
	<div class="row" ng-if="isLoading">
		<div class="col-md-12">
			<div class="alert alert-info text-center">
				<span class="glyphicon glyphicon-refresh glyphicon-spin"></span>
				æ­£åœ¨åŠ è½½æœˆä»½æ•°æ®ï¼Œè¯·ç¨å€™...
			</div>
		</div>
	</div>

	<!-- æ— æ•°æ®æç¤º -->
	<div class="row" ng-if="!isLoading && !currentMonthStats">
		<div class="col-md-12">
			<div class="alert alert-info">
				<span class="glyphicon glyphicon-info-sign"></span>
				æš‚æ— ç­¾åˆ°è®°å½•ã€‚
			</div>
		</div>
	</div>

</div>

<style>
.table-card {
	margin-bottom: 20px;
}
	.badge {
		margin-left: 5px;
	}
	.loading-status {
		padding: 8px;
		background-color: #f8f9fa;
		border-radius: 4px;
		text-align: center;
	}
	.glyphicon-spin {
		-webkit-animation: spin 1s infinite linear;
		animation: spin 1s infinite linear;
	}
	@-webkit-keyframes spin {
		0% { -webkit-transform: rotate(0deg); }
		100% { -webkit-transform: rotate(360deg); }
	}
	@keyframes spin {
		0% { transform: rotate(0deg); }
		100% { transform: rotate(360deg); }
	}
	.text-muted {
		font-size: 0.85em;
	}
	.btn-group {
		flex-wrap: wrap;
	}
	.btn-group .btn {
		margin: 2px;
	}
	th, td {
		vertical-align: middle !important;
	}
	.btn-group .btn-primary {
		font-weight: bold;
	}
</style>
